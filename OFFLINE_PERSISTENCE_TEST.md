# Firestore Offline Persistence 테스트 방법

## 구현 내용

Firestore Offline Persistence를 활용하여 네트워크 오류 시에도 증상/생리 주기 기록이 로컬 캐시에 저장되고, 네트워크 복구 시 자동으로 서버에 동기화되도록 구현했습니다.

### 주요 변경사항

1. **FirebaseService**: Firestore Offline Persistence 활성화
2. **증상 저장 로직**: 네트워크 오류 자동 처리 (권한 오류만 별도 처리)
3. **생리 주기 저장 로직**: 네트워크 오류 자동 처리 (권한 오류만 별도 처리)

## 테스트 방법

### 1. 오프라인 모드에서 저장 테스트

#### iOS 시뮬레이터

1. 앱 실행 후 로그인
2. 증상 또는 생리 주기 기록
3. **설정 > 네트워크 설정** 또는 **Settings > Developer > Network Link Conditioner**에서 네트워크 비활성화
4. 증상 또는 생리 주기 다시 기록
   - ✅ 정상적으로 저장되어야 함 (에러 없음)
   - ✅ UI에 즉시 반영되어야 함
5. 네트워크 다시 활성화
6. 약간 대기 (몇 초 ~ 몇 십 초)
7. Firestore Console에서 데이터 확인
   - ✅ 오프라인 중에 기록한 데이터가 서버에 동기화되어야 함

#### Android 에뮬레이터

1. 앱 실행 후 로그인
2. 증상 또는 생리 주기 기록
3. **설정 > 네트워크 및 인터넷 > Wi-Fi** 비활성화 또는 **Developer Options > Airplane mode** 활성화
4. 증상 또는 생리 주기 다시 기록
   - ✅ 정상적으로 저장되어야 함 (에러 없음)
   - ✅ UI에 즉시 반영되어야 함
5. 네트워크 다시 활성화
6. 약간 대기 (몇 초 ~ 몇 십 초)
7. Firestore Console에서 데이터 확인
   - ✅ 오프라인 중에 기록한 데이터가 서버에 동기화되어야 함

### 2. 네트워크 불안정 환경 테스트

1. 앱 실행 후 로그인
2. 증상 또는 생리 주기 여러 개 빠르게 기록
3. 네트워크를 끊고 다시 연결 (반복)
4. 모든 데이터가 정상적으로 서버에 동기화되는지 확인

### 3. 권한 오류 테스트 (동기화 실패 시나리오)

1. 앱 실행 후 로그인 (약관 동의 완료)
2. 로그아웃
3. 증상 또는 생리 주기 기록 시도
   - ⚠️ `permission-denied` 오류 발생 가능
   - ✅ 오류가 조용히 처리되어야 함 (동기화 실패 얼럿에서 처리 예정)

### 4. 앱 재시작 테스트

1. 오프라인 모드에서 증상 또는 생리 주기 기록
2. 앱 종료
3. 네트워크 활성화
4. 앱 재시작
5. Firestore Console에서 데이터 확인
   - ✅ 앱 재시작 전에 기록한 데이터도 서버에 동기화되어야 함

## 확인 방법

### Firestore Console에서 확인

1. Firebase Console 접속
2. **Firestore Database** 선택
3. `users/{uid}/symptoms` 또는 `users/{uid}/periodCycles` 경로 확인
4. 오프라인 중에 기록한 데이터가 나타나는지 확인

### 로그 확인 (선택)

개발 모드에서 다음과 같은 로그를 확인할 수 있습니다:

- Firestore가 오프라인 모드로 전환되었는지
- 네트워크 복구 시 자동 동기화가 시작되었는지

## 예상 동작

### 정상 동작

- ✅ 네트워크가 없어도 증상/생리 주기 기록 가능
- ✅ 기록 즉시 UI에 반영
- ✅ 네트워크 복구 시 자동 동기화
- ✅ 앱 재시작 후에도 동기화 유지

### 예외 상황

- ⚠️ 권한 오류(`permission-denied`): 사용자 데이터 동기화 실패 시 발생 (별도 처리 예정)
- ⚠️ 네트워크 오류: Offline Persistence가 자동 처리

## 참고사항

- Offline Persistence는 기본적으로 활성화되어 있지만, 명시적으로 설정하여 보장했습니다.
- 캐시 크기는 무제한(`CACHE_SIZE_UNLIMITED`)으로 설정되어 있습니다.
- 네트워크 복구 시 동기화는 백그라운드에서 자동으로 수행됩니다.
- 동기화는 수 초에서 수십 초까지 걸릴 수 있습니다.
